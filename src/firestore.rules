rules_version = '2';service cloud.firestore {match /databases/{database}/documents {function isSignedIn() {
  return request.auth != null;
}

// --- NEW RULE for Stats ---
// Allow any signed-in user to READ the dashboard stats
// but allow NO ONE (from the app) to write to it.
match /stats/dashboard {
  allow get: if isSignedIn();
  allow list, write, delete: if false;
}

// --- Your Existing Rules ---

// households/{householdId}
match /households/{householdId} {
  allow read, write: if isSignedIn();
  
  // Children subcollection
  match /children/{childId} {
    allow read, write: if isSignedIn();
  }
  
  // FollowUpVisits subcollection
  match /followUpVisits/{visitId} {
    allow read, write: if isSignedIn();
  }

  // ChildProgressUpdates nested subcollection
  match /children/{childId}/childProgressUpdates/{updateId} {
    allow read, write: if isSignedIn();
  }
}

// Collection Group Queries
match /{path=**}/children/{childId} {
  allow read: if isSignedIn();
}
match /{path=**}/followUpVisits/{visitId} {
  allow read: if isSignedIn();
}
match /{path=**}/childProgressUpdates/{updateId} {
  allow read: if isSignedIn();
}
}}